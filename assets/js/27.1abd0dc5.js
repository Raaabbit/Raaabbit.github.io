(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{473:function(t,s,n){"use strict";n.r(s);var a=n(25),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"技术总结-js的执行顺序"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#技术总结-js的执行顺序"}},[t._v("#")]),t._v(" 技术总结——JS的执行顺序")]),t._v(" "),n("blockquote",[n("p",[t._v("最近在准备面试，才发现对JS的运行机制掌握的还是很浅薄，看了不少文档、博客后在这里做一个简单的总结")])]),t._v(" "),n("h2",{attrs:{id:"基础知识"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础知识"}},[t._v("#")]),t._v(" 基础知识")]),t._v(" "),n("p",[t._v("我们都知道，为了避免对DOM的操作产生冲突（JS诞生之初只是为了给页面赋予一些动态效果），JS只有一个线程。即便是现在有了webworker来实现多线程进行任务处理，但实际上，JS的多线程其实是单线程模拟出来的。\n所以，为了保证JS的执行效率，异步成为了JS的一个核心的技术点。")]),t._v(" "),n("h2",{attrs:{id:"以往的印象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#以往的印象"}},[t._v("#")]),t._v(" 以往的印象")]),t._v(" "),n("p",[t._v("按照我之前的理解，所谓JS的异步操作就是注册一个回调函数，当触发回调函数的事件满足了，就挂起当前执行的任务，转而执行回调函数。\n事实证明我把JS想的太简单了～")]),t._v(" "),n("h2",{attrs:{id:"事实一，事件循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事实一，事件循环"}},[t._v("#")]),t._v(" 事实一，事件循环")]),t._v(" "),n("ol",[n("li",[t._v("首先，一门单线程语言从上向下执行")]),t._v(" "),n("li",[t._v("当遇到同步任务，让同步任务进入主线程开始执行；当遇到异步任务，注册异步任务的回调")]),t._v(" "),n("li",[t._v("当异步任务的触发条件完成，回调函数进入事件队列")]),t._v(" "),n("li",[t._v("当主线程中的同步任务完成，将事件队列中的任务拉入主线程")]),t._v(" "),n("li",[t._v("进入步骤2，继续～")])]),t._v(" "),n("p",[t._v("上面就是JS的执行顺序，用一个简单的栗子说明一下")]),t._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("foo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'异步回调执行'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'第一个同步任务'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("foo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'第二个同步任务'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br")])]),n("p",[t._v("上面代码的执行顺序是：")]),t._v(" "),n("ul",[n("li",[t._v("显示"),n("code",[t._v("第一个同步任务")])]),t._v(" "),n("li",[t._v("然后执行"),n("code",[t._v("setTimeout")]),t._v("将foo注册为回调，因为我们没有写延时，所以foo进入了事件队列")]),t._v(" "),n("li",[t._v("接下来显示"),n("code",[t._v("第二个同步任务")]),t._v("，至此主线程空了")]),t._v(" "),n("li",[t._v("foo被拉入主线程开始执行，显示"),n("code",[t._v("异步回调执行")])])]),t._v(" "),n("h2",{attrs:{id:"事实二，宏任务和微任务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#事实二，宏任务和微任务"}},[t._v("#")]),t._v(" 事实二，宏任务和微任务")]),t._v(" "),n("p",[t._v("除了同步任务和异步任务的差别，有时我们还需要进一步对任务进行划分，也就是宏任务和微任务。")]),t._v(" "),n("ul",[n("li",[t._v("宏任务主要包括script，setTimeout，setInterval")]),t._v(" "),n("li",[t._v("微任务主要包括Promise，process.nextTick")])]),t._v(" "),n("p",[t._v("随着任务的细化，任务队列也进一步分开了分为宏任务队列和微任务队列。")]),t._v(" "),n("p",[t._v("这时的执行顺序如下：")]),t._v(" "),n("ol",[n("li",[t._v("首先script作为第一个宏任务进入主线程开始执行")]),t._v(" "),n("li",[t._v("自上而下执行，当遇到同步任务直接在主线程执行；当遇到异步宏任务，进入宏任务队列；当遇到异步微任务，进入微任务队列")]),t._v(" "),n("li",[t._v("当前宏任务（第一次是script）结束后，检查微任务队列是否为空，如果不为空就拉入主线程执行。")]),t._v(" "),n("li",[t._v("当微任务队列执行完成后，从宏任务队列拉取一个宏任务进入主线程执行，转到步骤3")])]),t._v(" "),n("p",[t._v("我们还是举一个栗子")]),t._v(" "),n("div",{staticClass:"language-javascript line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'then又是一个微任务'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout是一个宏任务'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'then是一个微任务'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'console'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br")])]),n("p",[t._v("这段代码的执行顺序如下：")]),t._v(" "),n("ul",[n("li",[t._v("首先整段代码作为一个宏任务，进入主线程执行")]),t._v(" "),n("li",[t._v("遇到第一个"),n("code",[t._v("setTimeout")]),t._v("，将他的回调函数放到宏任务队列")]),t._v(" "),n("li",[t._v("遇到下面的"),n("code",[t._v("promise")]),t._v("将"),n("code",[t._v("then")]),t._v("，放到微任务队列")]),t._v(" "),n("li",[t._v("执行"),n("code",[t._v("console.log")]),t._v("，第一个宏任务结束，开始拉取微任务队列，显示"),n("code",[t._v("then是一个微任务")]),t._v("，微任务队列空")]),t._v(" "),n("li",[t._v("进入宏任务队列执行"),n("code",[t._v("setTimeout")]),t._v("的回调函数，将新的"),n("code",[t._v("promise.then")]),t._v("放到微任务队列，显示"),n("code",[t._v("setTimeout是一个宏任务")]),t._v("，当前宏任务结束，拉取微任务队列")]),t._v(" "),n("li",[t._v("显示"),n("code",[t._v("then又是一个微任务")]),t._v("，微任务队列空")]),t._v(" "),n("li",[t._v("宏任务和微任务全部执行完成，程序执行完成")])]),t._v(" "),n("blockquote",[n("p",[t._v("我的理解大致就是这样，如果有哪里写的不正确欢迎指正～")])])])}),[],!1,null,null,null);s.default=e.exports}}]);